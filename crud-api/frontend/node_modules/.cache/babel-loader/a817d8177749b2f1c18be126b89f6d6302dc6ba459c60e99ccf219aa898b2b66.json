{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.applyMiddlewares = exports.applyAuthChecker = exports.getParams = void 0;\nconst auth_middleware_1 = require(\"../helpers/auth-middleware\");\nconst types_1 = require(\"../helpers/types\");\nconst isPromiseLike_1 = require(\"../utils/isPromiseLike\");\nconst convert_args_1 = require(\"./convert-args\");\nconst validate_arg_1 = require(\"./validate-arg\");\nfunction getParams(params, resolverData, globalValidate, globalValidateFn) {\n  const paramValues = params.sort((a, b) => a.index - b.index).map(paramInfo => {\n    switch (paramInfo.kind) {\n      case \"args\":\n        return (0, validate_arg_1.validateArg)((0, convert_args_1.convertArgsToInstance)(paramInfo, resolverData.args), paramInfo.getType(), resolverData, globalValidate, paramInfo.validateSettings, globalValidateFn, paramInfo.validateFn);\n      case \"arg\":\n        return (0, validate_arg_1.validateArg)((0, convert_args_1.convertArgToInstance)(paramInfo, resolverData.args), paramInfo.getType(), resolverData, globalValidate, paramInfo.validateSettings, globalValidateFn, paramInfo.validateFn);\n      case \"context\":\n        if (paramInfo.propertyName) {\n          return resolverData.context[paramInfo.propertyName];\n        }\n        return resolverData.context;\n      case \"root\":\n        {\n          const rootValue = paramInfo.propertyName ? resolverData.root[paramInfo.propertyName] : resolverData.root;\n          if (!paramInfo.getType) {\n            return rootValue;\n          }\n          return (0, types_1.convertToType)(paramInfo.getType(), rootValue);\n        }\n      case \"info\":\n        return resolverData.info;\n      case \"custom\":\n        return paramInfo.resolver(resolverData);\n    }\n  });\n  if (paramValues.some(isPromiseLike_1.isPromiseLike)) {\n    return Promise.all(paramValues);\n  }\n  return paramValues;\n}\nexports.getParams = getParams;\nfunction applyAuthChecker(middlewares, authChecker, container, authMode, roles) {\n  if (authChecker && roles) {\n    middlewares.unshift((0, auth_middleware_1.AuthMiddleware)(authChecker, container, authMode, roles));\n  }\n}\nexports.applyAuthChecker = applyAuthChecker;\nfunction applyMiddlewares(container, resolverData, middlewares, resolverHandlerFunction) {\n  if (middlewares.length === 0) {\n    return resolverHandlerFunction();\n  }\n  let middlewaresIndex = -1;\n  async function dispatchHandler(currentIndex) {\n    if (currentIndex <= middlewaresIndex) {\n      throw new Error(\"next() called multiple times\");\n    }\n    middlewaresIndex = currentIndex;\n    let handlerFn;\n    if (currentIndex === middlewares.length) {\n      handlerFn = resolverHandlerFunction;\n    } else {\n      const currentMiddleware = middlewares[currentIndex];\n      if (currentMiddleware.prototype !== undefined) {\n        const middlewareClassInstance = await container.getInstance(currentMiddleware, resolverData);\n        handlerFn = middlewareClassInstance.use.bind(middlewareClassInstance);\n      } else {\n        handlerFn = currentMiddleware;\n      }\n    }\n    let nextResult;\n    const result = await handlerFn(resolverData, async () => {\n      nextResult = await dispatchHandler(currentIndex + 1);\n      return nextResult;\n    });\n    return result !== undefined ? result : nextResult;\n  }\n  return dispatchHandler(0);\n}\nexports.applyMiddlewares = applyMiddlewares;","map":{"version":3,"names":["Object","defineProperty","exports","value","applyMiddlewares","applyAuthChecker","getParams","auth_middleware_1","require","types_1","isPromiseLike_1","convert_args_1","validate_arg_1","params","resolverData","globalValidate","globalValidateFn","paramValues","sort","a","b","index","map","paramInfo","kind","validateArg","convertArgsToInstance","args","getType","validateSettings","validateFn","convertArgToInstance","propertyName","context","rootValue","root","convertToType","info","resolver","some","isPromiseLike","Promise","all","middlewares","authChecker","container","authMode","roles","unshift","AuthMiddleware","resolverHandlerFunction","length","middlewaresIndex","dispatchHandler","currentIndex","Error","handlerFn","currentMiddleware","prototype","undefined","middlewareClassInstance","getInstance","use","bind","nextResult","result"],"sources":["/Users/snawz1/node_modules/type-graphql/build/cjs/resolvers/helpers.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.applyMiddlewares = exports.applyAuthChecker = exports.getParams = void 0;\nconst auth_middleware_1 = require(\"../helpers/auth-middleware\");\nconst types_1 = require(\"../helpers/types\");\nconst isPromiseLike_1 = require(\"../utils/isPromiseLike\");\nconst convert_args_1 = require(\"./convert-args\");\nconst validate_arg_1 = require(\"./validate-arg\");\nfunction getParams(params, resolverData, globalValidate, globalValidateFn) {\n    const paramValues = params\n        .sort((a, b) => a.index - b.index)\n        .map(paramInfo => {\n        switch (paramInfo.kind) {\n            case \"args\":\n                return (0, validate_arg_1.validateArg)((0, convert_args_1.convertArgsToInstance)(paramInfo, resolverData.args), paramInfo.getType(), resolverData, globalValidate, paramInfo.validateSettings, globalValidateFn, paramInfo.validateFn);\n            case \"arg\":\n                return (0, validate_arg_1.validateArg)((0, convert_args_1.convertArgToInstance)(paramInfo, resolverData.args), paramInfo.getType(), resolverData, globalValidate, paramInfo.validateSettings, globalValidateFn, paramInfo.validateFn);\n            case \"context\":\n                if (paramInfo.propertyName) {\n                    return resolverData.context[paramInfo.propertyName];\n                }\n                return resolverData.context;\n            case \"root\": {\n                const rootValue = paramInfo.propertyName\n                    ? resolverData.root[paramInfo.propertyName]\n                    : resolverData.root;\n                if (!paramInfo.getType) {\n                    return rootValue;\n                }\n                return (0, types_1.convertToType)(paramInfo.getType(), rootValue);\n            }\n            case \"info\":\n                return resolverData.info;\n            case \"custom\":\n                return paramInfo.resolver(resolverData);\n        }\n    });\n    if (paramValues.some(isPromiseLike_1.isPromiseLike)) {\n        return Promise.all(paramValues);\n    }\n    return paramValues;\n}\nexports.getParams = getParams;\nfunction applyAuthChecker(middlewares, authChecker, container, authMode, roles) {\n    if (authChecker && roles) {\n        middlewares.unshift((0, auth_middleware_1.AuthMiddleware)(authChecker, container, authMode, roles));\n    }\n}\nexports.applyAuthChecker = applyAuthChecker;\nfunction applyMiddlewares(container, resolverData, middlewares, resolverHandlerFunction) {\n    if (middlewares.length === 0) {\n        return resolverHandlerFunction();\n    }\n    let middlewaresIndex = -1;\n    async function dispatchHandler(currentIndex) {\n        if (currentIndex <= middlewaresIndex) {\n            throw new Error(\"next() called multiple times\");\n        }\n        middlewaresIndex = currentIndex;\n        let handlerFn;\n        if (currentIndex === middlewares.length) {\n            handlerFn = resolverHandlerFunction;\n        }\n        else {\n            const currentMiddleware = middlewares[currentIndex];\n            if (currentMiddleware.prototype !== undefined) {\n                const middlewareClassInstance = await container.getInstance(currentMiddleware, resolverData);\n                handlerFn = middlewareClassInstance.use.bind(middlewareClassInstance);\n            }\n            else {\n                handlerFn = currentMiddleware;\n            }\n        }\n        let nextResult;\n        const result = await handlerFn(resolverData, async () => {\n            nextResult = await dispatchHandler(currentIndex + 1);\n            return nextResult;\n        });\n        return result !== undefined ? result : nextResult;\n    }\n    return dispatchHandler(0);\n}\nexports.applyMiddlewares = applyMiddlewares;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}